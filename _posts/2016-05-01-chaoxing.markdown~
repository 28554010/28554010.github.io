---
layout: post
title:  "那些年我们一起刷的课"
date:   2016-05-01 23:15:34 +0800
categories: jekyll update
---

这几年盛行网络教育。内容有选修课、继续教育等等，都要求必须观看完所有视频。这些课程质量一般都不高。授课者不是想着如何提高大家观看视频的兴趣，而是采取技术手段，让系统自动记录是否看完。企图强制大家看无聊的课程视频。其结果是很多人空开着浏览器，关掉声音，人做别的事。最后根本一分钟的视频都没看，还浪费不少电费。

记录视频播放的手段都差不多：播放器每隔1分钟或者几十秒向服务器发送一个HTTP请求，附带上当前播放的视频，当前播放的时间，用户名等等。这就给我们提供了一个秒刷的办法：修改一下这个请求的当前播放时间，把它改为视频播放结束的时间。服务器收到后，就会认为你已经播放完整个视频。

如何找到这个请求呢？只要打开Chrome浏览器的开发者工具，切换到“Network”选项卡，观察一下哪个请求每个1分钟左右重复出现。然后观察一下它的query string parameters，看看有没有名字为time之类的项目。

![Chrome开发者工具]({{ site.url }}/assets/inspect.png)

通常来说，找到了以后，只要右键复制为curl命令。修改代表当前播放时间的参数。粘贴到命令行执行就可以秒刷了。除非遇到下图这种有加密的情况。

![查询串参数]({{ site.url }}/assets/querystringparas.png)

遇到加密的情况，单纯修改时间没有用，服务器会判断出加密串与时间不对应，不接受你的播放记录。此时，需要先找到生成加密串的那段程序。这些程序肯定是在播放器的代码中。如果是flash播放器，只要把swf文件保存到我们的硬盘中。用ffdec反编译打开，查找一下，看看究竟加密串是在哪里产生的，然后修改一下程序，让它每次都发送视频播放完的记录给服务器。保存为新的swf文件。

![反编译swf]({{ site.url }}/assets/ffdec.png)

怎么用我们新编译的swf替换网页上原本的swf呢？这就需要用到fiddler代理。里面的AutoResponder选项卡可以让我们用本地的文件替换网页上的文件。用上我们修改后的播放器，每次一打开视频，网页就提示视频观看任务已经完成！

![替换swf]({{ site.url }}/assets/fiddler.png)



