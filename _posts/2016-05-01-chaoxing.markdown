---
layout: post
title: "那些年我們一起刷的課"
date: 2016-05-01 23:15:34 +0800
categories: jekyll update
---

# 緣起
這幾年盛行網絡教育。內容有選修課、繼續教育等等，都要求必須觀看完所有視頻。這些課程質量一般都不高。授課者不是想著如何提高大家觀看視頻的興趣，而是採取技術手段，讓系統自動記錄是否看完。企圖強制大家看無聊的課程視頻。其結果是很多人空開著瀏覽器，關掉聲音，人做別的事。最後根本一分鐘的視頻都沒看，還浪費不少電費。

# 機制
記錄視頻播放的手段都差不多：播放器每隔1分鐘或者幾十秒向服務器發送一個HTTP請求，附帶上當前播放的視頻，當前播放的時間，用戶名等等。這就給我們提供了一個秒刷的辦法：修改一下這個請求的當前播放時間，把它改為視頻播放結束的時間。服務器收到後，就會認為你已經播放完整個視頻。

# HTTP請求
如何找到這個請求呢？只要打開Chrome瀏覽器的開發者工具，切換到`Network`選項卡，觀察一下哪個請求每個1分鐘左右重複出現。然後觀察一下它的`query string parameters`，看看有沒有名字為time之類的項目。

![Chrome開發者工具]({{ site.url }}/assets/inspect.png)

通常來說，找到了以後，只要右鍵複製為curl命令。修改代表當前播放時間的參數。粘貼到命令行執行就可以秒刷了。除非遇到下圖這種有加密的情況。

# 加密串
![查詢串參數]({{ site.url }}/assets/querystringparas.png)

遇到加密的情況，單純修改時間沒有用，服務器會判斷出加密串與時間不對應，不接受你的播放記錄。此時，需要先找到生成加密串的那段程序。這些程序肯定是在播放器的代碼中。如果是flash播放器，只要把swf文件保存到我們的硬盤中。用ffdec反編譯打開，查找一下，看看究竟加密串是在哪裡產生的，然後修改一下程序，讓它每次都發送視頻播放完的記錄給服務器。保存為新的swf文件。

![反編譯swf]({{ site.url }}/assets/ffdec.png)

# 偷梁換柱
怎麼用我們新編譯的swf替換網頁上原本的swf呢？這就需要用到fiddler代理。裡面的AutoResponder選項卡可以讓我們用本地的文件替換網頁上的文件。用上我們修改後的播放器，每次一打開視頻，網頁就提示視頻觀看任務已經完成！

![替換swf]({{ site.url }}/assets/fiddler.png)
